{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 317558e04bf77a573c71","webpack:///./src/DecibelMeter.js","webpack:///./src/DecibelAnalyser.js","webpack:///./src/PubSub.js","webpack:///./src/index.js","webpack:///./src/registry.js","webpack:///./src/uuid.js"],"names":["DecibelMeter","id","listening","events","_connection","eventName","callback","on","off","dispatch","connection","dBAnalyser","start","stop","identifier","connectTo","then","meter","listen","source","MediaDeviceInfo","Promise","reject","TypeError","resolve","constraints","audio","mandatory","sourceId","deviceId","navigator","mediaDevices","getUserMedia","previous","oldSource","oldStream","stream","trackToDiscard","getAudioTracks","find","track","label","removeTrack","streamSource","disconnect","context","createMediaStreamSource","connect","analyser","AudioContext","createAnalyser","smoothingTimeConstant","lastSample","Uint8Array","running","sources","length","ReferenceError","stopListening","forEach","t","setTimeout","enumerateDevices","devices","filter","device","kind","Error","DecibelAnalyser","_running","getByteFrequencyData","value","percent","dB","minDecibels","maxDecibels","requestAnimationFrame","update","PubSub","eventIndex","index","push","splice","includes","indexOf","params","apply","default","registry","register","getById","__decibelMeters","uuid","d","performance","now","replace","c","r","Math","random","floor","toString"],"mappings":"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","file":"decibel-meter.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"DecibelMeter\"] = factory();\n\telse\n\t\troot[\"DecibelMeter\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 317558e04bf77a573c71","import uuid from 'uuid'\nimport PubSub from 'PubSub'\nimport DecibelAnalyser from 'DecibelAnalyser'\nimport { registry, register, getById } from 'registry'\n\nexport default class DecibelMeter {\n\n\tconstructor(id = uuid()) {\n\t\tthis.id = id\n\t\tthis.listening = false\n\t\tthis.events = new PubSub(this)\n\n\t\tthis._connection = null\n\n\t\tregister(this)\n\t}\n\n\tget source() {\n\t\treturn this._connection && this._connection.source ? this._connection.source : null\n\t}\n\n\tget connection() {\n\t\treturn this._connection\n\t}\n\n\tget sources() {\n\t\tif (navigator.mediaDevices && navigator.mediaDevices.enumerateDevices)\n\t\t\treturn navigator.mediaDevices.enumerateDevices().then(devices => devices.filter(device => device.kind === 'audioinput'))\n\t\telse\n\t\t\treturn Promise.reject(new Error('MediaDevices.enumerateDevices() is not supported'))\n\t}\n\n\tget connected() {\n\t\treturn this._connection !== null\n\t}\n\n\ton(eventName, callback) {\n\t\tthis.events.on(eventName, callback)\n\t\treturn callback\n\t}\n\n\toff(eventName = null, callback = null) {\n\t\tthis.events.off(eventName, callback)\n\t\treturn callback\n\t}\n\n\tlisten() {\n\t\tif (!this.listening) {\n\n\t\t\tthis.listening = true\n\t\t\tthis.events.dispatch('change', this.listening)\n\n\t\t\tif (this.connection)\n\t\t\t\tthis.connection.dBAnalyser.start()\n\t\t}\n\n\t\treturn this\n\t}\n\n\tstopListening() {\n\t\tif (this.listening) {\n\n\t\t\tif (this.connection)\n\t\t\t\tthis.connection.dBAnalyser.stop()\n\n\t\t\tthis.listening = false\n\t\t\tthis.events.dispatch('change', this.listening)\n\t\t}\n\n\t\treturn this\n\t}\n\n\tlistenTo(identifier, callback) {\n\t\treturn this.connectTo(identifier).then(meter => {\n\n\t\t\tthis.events.on('sample', callback)\n\t\t\tmeter.listen()\n\n\t\t\treturn this\n\t\t})\n\t}\n\n\tconnect(source) {\n\t\tif (!(source instanceof MediaDeviceInfo))\n\t\t\treturn Promise.reject(new TypeError('DecibelMeter: Expected first parameter to be of type MediaDeviceInfo'))\n\t\telse {\n\n\t\t\t// connection exists, and already connection to requested source\n\n\t\t\tif (this._connection && this._connection.source === source)\n\t\t\t\treturn Promise.resolve(this)\n\n\t\t\t// audio source constraints\n\n\t\t\tconst constraints = {\n\t\t\t\taudio: {\n\t\t\t\t\tmandatory: {\n\t\t\t\t\t\tsourceId: source.deviceId // force specific selected device\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// connect\n\n\t\t\treturn navigator.mediaDevices.getUserMedia(constraints).then(stream => {\n\n\t\t\t\tlet previous = null, connection\n\n\t\t\t\t// already have a connection?\n\n\t\t\t\tif (this._connection) {\n\n\t\t\t\t\t// note previous source\n\n\t\t\t\t\tprevious = this._connection.source\n\n\t\t\t\t\t// we already have a connection, but to a different source\n\n\t\t\t\t\tconst oldSource = this._connection.source\n\t\t\t\t\tconst oldStream = this._connection.stream\n\n\t\t\t\t\t// disconnect track for old source, if connected to stream\n\n\t\t\t\t\tconst trackToDiscard = oldStream.getAudioTracks().find(track => track.label === oldSource.label)\n\n\t\t\t\t\tif (trackToDiscard) {\n\t\t\t\t\t\ttrackToDiscard.stop()\n\t\t\t\t\t\toldStream.removeTrack(trackToDiscard)\n\t\t\t\t\t}\n\n\t\t\t\t\t// stop analyzing dB\n\n\t\t\t\t\tthis._connection.dBAnalyser.stop()\n\n\t\t\t\t\t// disconnect stream source\n\n\t\t\t\t\tthis._connection.streamSource.disconnect()\n\n\t\t\t\t\t// discard old stream\n\n\t\t\t\t\tdelete this._connection.stream\n\t\t\t\t\tdelete this._connection.streamSource\n\n\t\t\t\t\t// set new properties\n\n\t\t\t\t\tconnection = this._connection\n\n\t\t\t\t\tconnection.source = source\n\t\t\t\t\tconnection.stream = stream\n\t\t\t\t\tconnection.streamSource = connection.context.createMediaStreamSource(stream)\n\t\t\t\t\tconnection.streamSource.connect(connection.analyser)\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// first time connecting\n\n\t\t\t\t\tconnection = { stream, source, context: new AudioContext }\n\n\t\t\t\t\tconnection.analyser = connection.context.createAnalyser()\n\t\t\t\t\tconnection.analyser.smoothingTimeConstant = .5\n\t\t\t\t\tconnection.lastSample = new Uint8Array(1)\n\t\t\t\t\tconnection.streamSource = connection.context.createMediaStreamSource(stream)\n\t\t\t\t\tconnection.streamSource.connect(connection.analyser)\n\t\t\t\t\tconnection.dBAnalyser = new DecibelAnalyser(this)\n\n\t\t\t\t\tthis._connection = connection\n\t\t\t\t}\n\n\t\t\t\tthis.events.dispatch('connect', source, previous)\n\n\t\t\t\t// listening may have started prior to connecting, or source changed\n\n\t\t\t\tif (this.listening && !connection.dBAnalyser.running)\n\t\t\t\t\tconnection.dBAnalyser.start()\n\n\t\t\t\treturn this // finally, resolve with DecibelMeter itself\n\t\t\t})\n\t\t}\n\t}\n\n\tconnectTo(identifier) {\n\t\treturn this.sources.then(sources => {\n\t\t\tif (sources.length === 0)\n\t\t\t\tthrow new ReferenceError('DecibelMeter: No audioinput sources available')\n\n\t\t\tif (typeof identifier === 'number')\n\t\t\t\treturn sources[identifier] ? this.connect(sources[identifier]) : Promise.reject(new ReferenceError(`DecibelMeter: Source not found INDEX ${identifier}`))\n\n\t\t\tif (typeof identifier === 'string') {\n\t\t\t\tconst source = sources.find(source => source.deviceId === identifier)\n\n\t\t\t\treturn source ? this.connect(source) : Promise.reject(new ReferenceError(`DecibelMeter: Source not found DEVICEID ${identifier}`))\n\t\t\t}\n\n\t\t\treturn Promise.reject(new TypeError('DecibelMeter: Invalid source identifier'))\n\t\t})\n\t}\n\n\tdisconnect() {\n\t\tthis.stopListening()\n\n\t\tif (this.connection) {\n\t\t\tthis.connection.dBAnalyser.stop()\n\t\t\tthis.connection.streamSource.disconnect()\n\t\t\tthis.connection.stream.getAudioTracks().forEach(t => t.stop())\n\t\t}\n\n\t\treturn new Promise(resolve => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tdelete this._connection.stream\n\t\t\t\tdelete this._connection.streamSource\n\n\t\t\t\tthis._connection = null\n\n\t\t\t\tthis.events.dispatch('disconnect')\n\n\t\t\t\tresolve(this)\n\t\t\t}, 100)\n\t\t})\n\t}\n\n\tstatic getMeterById(id) {\n\t\treturn getById(id)\n\t}\n\n\tstatic get meters() {\n\t\treturn registry()\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/DecibelMeter.js","export default class DecibelAnalyser {\n\n\tget running() {\n\t\treturn this._running\n\t}\n\n\tconstructor(meter) {\n\t\tthis.meter = meter\n\t\tthis._running = false\n\t}\n\n\tupdate() {\n\t\tlet { analyser, lastSample } = this.meter.connection\n\n\t\tanalyser.getByteFrequencyData(lastSample)\n\n\t\t//console.log('audio sample', lastSample)\n\n\t\tlet value = lastSample[0]\n\t\tlet percent = value / 255\n\t\tlet dB = analyser.minDecibels + ((analyser.maxDecibels - analyser.minDecibels) * percent)\n\n\t\tthis.meter.events.dispatch('sample', dB, value, percent, analyser.minDecibels, analyser.maxDecibels)\n\n\t\tif (this._running)\n\t\t\trequestAnimationFrame(() => this.update())\n\t}\n\n\tstart() {\n\t\tthis._running = true\n\t\tthis.update()\n\t}\n\n\tstop() {\n\t\tthis._running = false\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/DecibelAnalyser.js","export default class PubSub {\r\n\r\n\tconstructor(context) {\r\n\t\tthis.context = context\r\n\t\tthis.eventIndex = {}\r\n\t}\r\n\r\n\tindex(eventName) {\r\n\t\treturn this.eventIndex[eventName] ? this.eventIndex[eventName] : this.eventIndex[eventName] = []\r\n\t}\r\n\r\n\ton(eventName, callback) {\r\n\t\tthis.index(eventName).push(callback)\r\n\t}\r\n\r\n\toff(eventName = null, callback = null) {\r\n\r\n\t\t// remove all callbacks\r\n\r\n\t\tif (eventName === null)\r\n\t\t\treturn this.eventIndex = {}\r\n\r\n\t\tconst index = this.index(eventName)\r\n\r\n\t\t// remove all callbacks for eventName\r\n\r\n\t\tif (callback === null)\r\n\t\t\treturn index.splice(0)\r\n\r\n\t\t// remove specific callback for eventName\r\n\r\n\t\tif (index.includes(callback))\r\n\t\t\tindex.splice(index.indexOf(callback), 1)\r\n\t}\r\n\r\n\tdispatch(eventName, ...params) {\r\n\t\tthis.index(eventName).forEach(callback => callback.apply(this.context, params))\r\n\t}\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/PubSub.js","export { default } from 'DecibelMeter'\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","\nexport function registry() {\n\tif (typeof navigator.__decibelMeters === 'undefined')\n\t\tnavigator.__decibelMeters = {}\n\treturn navigator.__decibelMeters\n}\n\nexport function register(meter) {\n\treturn registry()[meter.id] = meter\n}\n\nexport function getById(id) {\n\treturn registry()[id] || null\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/registry.js","export default function uuid() {\n  let d = performance.now();\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    let r = (d + Math.random() * 16) % 16 | 0\n    d = Math.floor(d/16);\n    return (c=='x' ? r : (r&0x3|0x8)).toString(16);\n  })\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/uuid.js"],"sourceRoot":""}