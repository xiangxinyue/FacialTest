{"ast":null,"code":"var _jsxFileName = \"/Users/user/Documents/RA/FacialTest/client/src/components/speech-in-noise/main.jsx\";\nimport React from \"react\";\nimport { Input, Container, CircularProgress } from \"@material-ui/core\";\n\nclass Survey extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.componentDidMount = async () => {\n      // preload audios\n      const noise = new Audio(process.env.PUBLIC_URL + \"/audios/noise.wav\");\n      await noise.play();\n      await noise.pause();\n\n      for (let i = 1; i < 10; i++) {\n        const audio = new Audio(process.env.PUBLIC_URL + \"/audios/\" + i + \".wav\");\n        audio.volume = 0;\n        await audio.play();\n      } // real testig starts\n\n\n      console.log(\"Finish preload audios\");\n      this.setState({\n        loading: false\n      });\n      await this._focus();\n      this.handlePlay();\n    };\n\n    this.componentDidUpdate = () => {\n      this._focus();\n    };\n\n    this._focus = () => {\n      const {\n        focus\n      } = this.state;\n\n      switch (focus) {\n        case 0:\n          return this.input1.focus();\n\n        case 1:\n          return this.input2.focus();\n\n        case 2:\n          return this.input3.focus();\n\n        default:\n          return null;\n      }\n    };\n\n    this.startTimer = () => {\n      this.timer = setInterval(() => this.setState({\n        time: this.state.time + 0.01\n      }), 10);\n      console.log(\"start\");\n    };\n\n    this.stopTimer = () => {\n      clearInterval(this.timer);\n      console.log(\"stop\");\n    };\n\n    this.resetTimer = () => {\n      this.setState({\n        time: 0\n      });\n      console.log(\"reset\");\n    };\n\n    this.handlePlay = async () => {\n      const {\n        audioVolume,\n        noiseVolume,\n        timer,\n        noise\n      } = this.state;\n      console.log(\"Signal Volume: \" + audioVolume);\n      console.log(\"Noise Volume: \" + noiseVolume);\n      await this.setState({\n        disabled: true\n      });\n\n      if (this.state.time !== 0) {\n        this.stopTimer();\n        timer.push(Number(this.state.time).toFixed(2));\n        this.resetTimer();\n        this.setState({\n          timer\n        });\n      }\n\n      console.log(\"Timer:\", this.state.timer);\n      console.log(\"DB:\", this.state.dbs);\n      const audios = [];\n\n      for (let i = 0; i < 3; i++) {\n        const index = Math.floor(Math.random() * 9) + 1;\n        await this.setState({\n          realAnswer: this.state.realAnswer + index.toString()\n        });\n        audios.push(new Audio(process.env.PUBLIC_URL + \"/audios/\" + index + \".wav\"));\n      }\n\n      setTimeout(() => {\n        noise.volume = noiseVolume;\n        noise.play();\n      }, 100);\n      setTimeout(() => {\n        const audio = audios[0];\n        audio.volume = audioVolume;\n        audio.play();\n      }, 500);\n      setTimeout(() => {\n        const audio = audios[1];\n        audio.volume = audioVolume;\n        audio.play();\n      }, 1700);\n      setTimeout(() => {\n        const audio = audios[2];\n        audio.volume = audioVolume;\n        audio.play();\n      }, 2900);\n      setTimeout(() => {\n        noise.pause();\n        this.setState({\n          disabled: false\n        });\n        this.startTimer();\n      }, 4100);\n    };\n\n    this.checkAnswer = async () => {\n      const {\n        realAnswer,\n        input1,\n        input2,\n        input3,\n        step\n      } = this.state;\n      const userAnswer = input1 + input2 + input3;\n      console.log(\"Real Answer: \" + realAnswer);\n      console.log(\"User Answer: \" + userAnswer);\n\n      if (realAnswer !== userAnswer) {\n        const audioVolume = this.goEasier(step);\n        await this.setState({\n          audioVolume\n        });\n        console.log(\"WRONG, increasing audio volume to \" + this.state.audioVolume);\n      } else {\n        const audioVolume = this.goHarder(step);\n        await this.setState({\n          audioVolume\n        });\n        console.log(\"RIGHT, decreasing audio volume to \" + this.state.audioVolume);\n      }\n\n      if (step !== 20) {\n        this.setState({\n          realAnswer: \"\",\n          input1: \"\",\n          input2: \"\",\n          input3: \"\",\n          step: step + 1\n        });\n        this.handlePlay();\n      } else {\n        // Timer\n        this.stopTimer();\n        const timer = this.state.timer;\n        timer.push(Number(this.state.time).toFixed(2)); // SNR\n\n        let sum = 0;\n\n        for (let i = 15; i < 20; i++) {\n          sum += this.state.dbs[i];\n        }\n\n        const SNR = Number(sum / 5).toFixed(2); // const SNR = Number(10 * Math.log(Math.abs(avg))).toFixed(3);\n\n        console.log(\"SNR is \" + SNR); // return SNR and Timer\n\n        this.props.handleFinish(SNR, timer);\n      }\n    };\n\n    this.goEasier = () => {\n      const {\n        audioVolume,\n        step,\n        dbs\n      } = this.state;\n\n      if (step <= 4) {\n        dbs.push(dbs[step - 1] + 4);\n        this.setState({\n          dbs\n        });\n\n        if (audioVolume * 10 ** (4 / 20) > 1) {\n          return 1;\n        } else {\n          return audioVolume * 10 ** (4 / 20);\n        }\n      } else {\n        dbs.push(dbs[step - 1] + 2);\n        this.setState({\n          dbs\n        });\n\n        if (audioVolume * 10 ** (2 / 20) > 1) {\n          return 1;\n        } else {\n          return audioVolume * 10 ** (2 / 20);\n        }\n      }\n    };\n\n    this.goHarder = () => {\n      const {\n        audioVolume,\n        step,\n        dbs\n      } = this.state;\n\n      if (step <= 4) {\n        dbs.push(dbs[step - 1] - 4);\n        this.setState({\n          dbs\n        });\n        return audioVolume * 10 ** (-4 / 20);\n      } else {\n        dbs.push(dbs[step - 1] - 2);\n        this.setState({\n          dbs\n        });\n        return audioVolume * 10 ** (-2 / 20);\n      }\n    };\n\n    this.changeAnswer = async value => {\n      const {\n        focus\n      } = this.state;\n\n      switch (focus) {\n        case 0:\n          return await this.setState({\n            input1: value,\n            focus: 1\n          });\n\n        case 1:\n          return await this.setState({\n            input2: value,\n            focus: 2\n          });\n\n        case 2:\n          await this.setState({\n            input3: value,\n            focus: 0\n          });\n          return this.checkAnswer();\n\n        default:\n          return null;\n      }\n    };\n\n    this.renderInputs = () => {\n      const {\n        focus,\n        input1,\n        input2,\n        input3,\n        disabled,\n        loading\n      } = this.state;\n      return /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 228,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(Input, {\n        value: input1,\n        disabled: disabled || focus !== 0,\n        inputRef: input => {\n          this.input1 = input;\n        },\n        inputProps: {\n          maxLength: 1\n        },\n        required: true,\n        onChange: e => this.changeAnswer(e.target.value),\n        style: {\n          width: 30,\n          marginRight: 30\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 229,\n          columnNumber: 9\n        }\n      }), /*#__PURE__*/React.createElement(Input, {\n        value: input2,\n        disabled: disabled || focus !== 1,\n        inputRef: input => {\n          this.input2 = input;\n        },\n        inputProps: {\n          maxLength: 1\n        },\n        required: true,\n        onChange: e => this.changeAnswer(e.target.value),\n        style: {\n          width: 30\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 242,\n          columnNumber: 9\n        }\n      }), /*#__PURE__*/React.createElement(Input, {\n        value: input3,\n        disabled: disabled || focus !== 2,\n        inputRef: input => {\n          this.input3 = input;\n        },\n        inputProps: {\n          maxLength: 1\n        },\n        required: true,\n        onChange: e => this.changeAnswer(e.target.value),\n        style: {\n          width: 30,\n          marginLeft: 30\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 255,\n          columnNumber: 9\n        }\n      }), loading ? /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 269,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(CircularProgress, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 270,\n          columnNumber: 13\n        }\n      }), \"Loading ...\", \" \") : null);\n    };\n\n    this.state = {\n      noise: new Audio(process.env.PUBLIC_URL + \"/audios/noise.wav\"),\n      noiseVolume: this.props.volume / 100,\n      audioVolume: this.props.volume / 100,\n      realAnswer: \"\",\n      focus: 0,\n      input1: \"\",\n      input2: \"\",\n      input3: \"\",\n      step: 1,\n      disabled: true,\n      loading: true,\n      time: 0,\n      timer: [],\n      dbs: [0]\n    };\n    this.input1 = React.createRef();\n    this.input2 = React.createRef();\n    this.input3 = React.createRef();\n  }\n\n  render() {\n    const {\n      step\n    } = this.state;\n    return /*#__PURE__*/React.createElement(Container, {\n      style: {\n        textAlign: \"center\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 281,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      style: {\n        marginTop: \"10%\",\n        marginBottom: \"10%\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 282,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 283,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"h5\", {\n      className: \"font-weight-light\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 284,\n        columnNumber: 13\n      }\n    }, \"Use your keyboard to enter the numbers you hear\")), this.renderInputs(), /*#__PURE__*/React.createElement(\"h6\", {\n      className: \"font-weight-lighter\",\n      style: {\n        marginTop: 10\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 289,\n        columnNumber: 11\n      }\n    }, \"Step \", step, \" of 20\")));\n  }\n\n}\n\nexport default Survey;","map":{"version":3,"sources":["/Users/user/Documents/RA/FacialTest/client/src/components/speech-in-noise/main.jsx"],"names":["React","Input","Container","CircularProgress","Survey","Component","constructor","props","componentDidMount","noise","Audio","process","env","PUBLIC_URL","play","pause","i","audio","volume","console","log","setState","loading","_focus","handlePlay","componentDidUpdate","focus","state","input1","input2","input3","startTimer","timer","setInterval","time","stopTimer","clearInterval","resetTimer","audioVolume","noiseVolume","disabled","push","Number","toFixed","dbs","audios","index","Math","floor","random","realAnswer","toString","setTimeout","checkAnswer","step","userAnswer","goEasier","goHarder","sum","SNR","handleFinish","changeAnswer","value","renderInputs","input","maxLength","e","target","width","marginRight","marginLeft","createRef","render","textAlign","marginTop","marginBottom"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { Input, Container, CircularProgress } from \"@material-ui/core\";\n\nclass Survey extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      noise: new Audio(process.env.PUBLIC_URL + \"/audios/noise.wav\"),\n      noiseVolume: this.props.volume / 100,\n      audioVolume: this.props.volume / 100,\n      realAnswer: \"\",\n      focus: 0,\n      input1: \"\",\n      input2: \"\",\n      input3: \"\",\n      step: 1,\n      disabled: true,\n      loading: true,\n      time: 0,\n      timer: [],\n      dbs: [0],\n    };\n    this.input1 = React.createRef();\n    this.input2 = React.createRef();\n    this.input3 = React.createRef();\n  }\n\n  componentDidMount = async () => {\n    // preload audios\n    const noise = new Audio(process.env.PUBLIC_URL + \"/audios/noise.wav\");\n    await noise.play();\n    await noise.pause();\n    for (let i = 1; i < 10; i++) {\n      const audio = new Audio(process.env.PUBLIC_URL + \"/audios/\" + i + \".wav\");\n      audio.volume = 0;\n      await audio.play();\n    }\n    // real testig starts\n    console.log(\"Finish preload audios\");\n    this.setState({ loading: false });\n    await this._focus();\n    this.handlePlay();\n  };\n\n  componentDidUpdate = () => {\n    this._focus();\n  };\n\n  _focus = () => {\n    const { focus } = this.state;\n    switch (focus) {\n      case 0:\n        return this.input1.focus();\n      case 1:\n        return this.input2.focus();\n      case 2:\n        return this.input3.focus();\n      default:\n        return null;\n    }\n  };\n\n  startTimer = () => {\n    this.timer = setInterval(\n      () =>\n        this.setState({\n          time: this.state.time + 0.01,\n        }),\n      10\n    );\n    console.log(\"start\");\n  };\n  stopTimer = () => {\n    clearInterval(this.timer);\n    console.log(\"stop\");\n  };\n  resetTimer = () => {\n    this.setState({ time: 0 });\n    console.log(\"reset\");\n  };\n\n  handlePlay = async () => {\n    const { audioVolume, noiseVolume, timer, noise } = this.state;\n    console.log(\"Signal Volume: \" + audioVolume);\n    console.log(\"Noise Volume: \" + noiseVolume);\n    await this.setState({ disabled: true });\n    if (this.state.time !== 0) {\n      this.stopTimer();\n      timer.push(Number(this.state.time).toFixed(2));\n      this.resetTimer();\n      this.setState({ timer });\n    }\n    console.log(\"Timer:\", this.state.timer);\n    console.log(\"DB:\", this.state.dbs);\n    const audios = [];\n    for (let i = 0; i < 3; i++) {\n      const index = Math.floor(Math.random() * 9) + 1;\n      await this.setState({\n        realAnswer: this.state.realAnswer + index.toString(),\n      });\n      audios.push(\n        new Audio(process.env.PUBLIC_URL + \"/audios/\" + index + \".wav\")\n      );\n    }\n    setTimeout(() => {\n      noise.volume = noiseVolume;\n      noise.play();\n    }, 100);\n    setTimeout(() => {\n      const audio = audios[0];\n      audio.volume = audioVolume;\n      audio.play();\n    }, 500);\n    setTimeout(() => {\n      const audio = audios[1];\n      audio.volume = audioVolume;\n      audio.play();\n    }, 1700);\n    setTimeout(() => {\n      const audio = audios[2];\n      audio.volume = audioVolume;\n      audio.play();\n    }, 2900);\n    setTimeout(() => {\n      noise.pause();\n      this.setState({ disabled: false });\n      this.startTimer();\n    }, 4100);\n  };\n\n  checkAnswer = async () => {\n    const { realAnswer, input1, input2, input3, step } = this.state;\n    const userAnswer = input1 + input2 + input3;\n    console.log(\"Real Answer: \" + realAnswer);\n    console.log(\"User Answer: \" + userAnswer);\n    if (realAnswer !== userAnswer) {\n      const audioVolume = this.goEasier(step);\n      await this.setState({ audioVolume });\n      console.log(\n        \"WRONG, increasing audio volume to \" + this.state.audioVolume\n      );\n    } else {\n      const audioVolume = this.goHarder(step);\n      await this.setState({ audioVolume });\n      console.log(\n        \"RIGHT, decreasing audio volume to \" + this.state.audioVolume\n      );\n    }\n    if (step !== 20) {\n      this.setState({\n        realAnswer: \"\",\n        input1: \"\",\n        input2: \"\",\n        input3: \"\",\n        step: step + 1,\n      });\n      this.handlePlay();\n    } else {\n      // Timer\n      this.stopTimer();\n      const timer = this.state.timer;\n      timer.push(Number(this.state.time).toFixed(2));\n      // SNR\n      let sum = 0;\n      for (let i = 15; i < 20; i++) {\n        sum += this.state.dbs[i];\n      }\n      const SNR = Number(sum / 5).toFixed(2);\n      // const SNR = Number(10 * Math.log(Math.abs(avg))).toFixed(3);\n      console.log(\"SNR is \" + SNR);\n      // return SNR and Timer\n      this.props.handleFinish(SNR, timer);\n    }\n  };\n\n  goEasier = () => {\n    const { audioVolume, step, dbs } = this.state;\n    if (step <= 4) {\n      dbs.push(dbs[step - 1] + 4);\n      this.setState({ dbs });\n      if (audioVolume * 10 ** (4 / 20) > 1) {\n        return 1;\n      } else {\n        return audioVolume * 10 ** (4 / 20);\n      }\n    } else {\n      dbs.push(dbs[step - 1] + 2);\n      this.setState({ dbs });\n      if (audioVolume * 10 ** (2 / 20) > 1) {\n        return 1;\n      } else {\n        return audioVolume * 10 ** (2 / 20);\n      }\n    }\n  };\n\n  goHarder = () => {\n    const { audioVolume, step, dbs } = this.state;\n    if (step <= 4) {\n      dbs.push(dbs[step - 1] - 4);\n      this.setState({ dbs });\n      return audioVolume * 10 ** (-4 / 20);\n    } else {\n      dbs.push(dbs[step - 1] - 2);\n      this.setState({ dbs });\n      return audioVolume * 10 ** (-2 / 20);\n    }\n  };\n\n  changeAnswer = async (value) => {\n    const { focus } = this.state;\n    switch (focus) {\n      case 0:\n        return await this.setState({ input1: value, focus: 1 });\n      case 1:\n        return await this.setState({ input2: value, focus: 2 });\n      case 2:\n        await this.setState({ input3: value, focus: 0 });\n        return this.checkAnswer();\n      default:\n        return null;\n    }\n  };\n\n  renderInputs = () => {\n    const { focus, input1, input2, input3, disabled, loading } = this.state;\n    return (\n      <div>\n        <Input\n          value={input1}\n          disabled={disabled || focus !== 0}\n          inputRef={(input) => {\n            this.input1 = input;\n          }}\n          inputProps={{\n            maxLength: 1,\n          }}\n          required={true}\n          onChange={(e) => this.changeAnswer(e.target.value)}\n          style={{ width: 30, marginRight: 30 }}\n        />\n        <Input\n          value={input2}\n          disabled={disabled || focus !== 1}\n          inputRef={(input) => {\n            this.input2 = input;\n          }}\n          inputProps={{\n            maxLength: 1,\n          }}\n          required={true}\n          onChange={(e) => this.changeAnswer(e.target.value)}\n          style={{ width: 30 }}\n        />\n        <Input\n          value={input3}\n          disabled={disabled || focus !== 2}\n          inputRef={(input) => {\n            this.input3 = input;\n          }}\n          inputProps={{\n            maxLength: 1,\n          }}\n          required={true}\n          onChange={(e) => this.changeAnswer(e.target.value)}\n          style={{ width: 30, marginLeft: 30 }}\n        />\n        {loading ? (\n          <div>\n            <CircularProgress />\n            Loading ...{\" \"}\n          </div>\n        ) : null}\n      </div>\n    );\n  };\n\n  render() {\n    const { step } = this.state;\n    return (\n      <Container style={{ textAlign: \"center\" }}>\n        <div style={{ marginTop: \"10%\", marginBottom: \"10%\" }}>\n          <div>\n            <h5 className=\"font-weight-light\">\n              Use your keyboard to enter the numbers you hear\n            </h5>\n          </div>\n          {this.renderInputs()}\n          <h6 className=\"font-weight-lighter\" style={{ marginTop: 10 }}>\n            Step {step} of 20\n          </h6>\n        </div>\n      </Container>\n    );\n  }\n}\n\nexport default Survey;\n"]},"metadata":{},"sourceType":"module"}